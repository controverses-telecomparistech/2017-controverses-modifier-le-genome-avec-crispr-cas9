<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>WebGL model renderer</title>
    <script src="three.min.js"></script>
    <style>
      body { margin:0.; }
      canvas { width:100%; height:100%; }
    </style>
  </head>
  <body>
    <script type="text/javascript">
      // Code du rendu 3D
      var renderer, scene, camera, mesh;
      var raycaster = new THREE.Raycaster(); // pour détecter quel objet est sous la souris
      var dialogBoxes = [];
      
      initScene();
      animate();
      
      function initScene()
      {
        renderer = new THREE.WebGLRenderer({ antialias:true });
        renderer.setSize(window.innerWidth, window.innerHeight);
        document.body.appendChild(renderer.domElement);
        
        scene = new THREE.Scene();
        camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 1, 1000);
        camera.position.z = 10;
        scene.add(camera);
        
        var dirLight = new THREE.DirectionalLight(0xffffff, 0.95);
        dirLight.position.set(-3, 3, 7);
        dirLight.position.normalize();
        scene.add(dirLight);
        
        var pointLight = new THREE.PointLight(0xffffff, 5, 50);
        pointLight.position.set(10, 20, -10);
        scene.add(pointLight);
        
        // Ajout du gros modèle 3D d'ADN
        var jsonLoader = new THREE.JSONLoader();
        jsonLoader.load("dna.json", function(geometry, materials)
          {
            mesh = new THREE.Mesh(geometry, materials[0]);
            mesh.rotation.order = "ZXY";
            mesh.rotation.z = 0.5;
            mesh.position.z = -100; // distance respectable, c'est que le modèle est plutôt gros
            // setupControls();
            scene.add(mesh);
          });
        
        // Ajout de quelques boîtes cliquables pour les liens des pages
        var g = new THREE.PlaneGeometry(20, 5);
        var m = new THREE.MeshBasicMaterial({color:0xccccff, side: THREE.DoubleSide});
        var frustum = new THREE.Frustum();
        frustum.setFromMatrix(camera.projectionMatrix);
        for(var i = 0; i < 3; i++)
        {
          dialogBoxes[i] = new THREE.Mesh(g, m);
          dialogBoxes[i].name = "Box " + (i + 1);
          var p = new THREE.Vector3();
          do
          {
            p.set(Math.random() * 100 - 50, Math.random() * 100 - 50, -50);
            
          } while(!frustum.containsPoint(p) || !frustum.containsPoint(p.clone().add(20, 5, 0)));
          dialogBoxes[i].position.set(p.x, p.y, p.z);
          scene.add(dialogBoxes[i]);
        }
        // On fait en sorte que les boîtes réagissent au clic
        renderer.domElement.addEventListener("mouseup", mouseup);
        
        function mouseup(event)
        {
          if(event.button == 0)
          {
            var mouse = new THREE.Vector2();
            mouse.x = event.clientX / window.innerWidth * 2. - 1.;
            mouse.y = -event.clientY / window.innerHeight * 2. + 1.;
            raycaster.setFromCamera(mouse, camera);
            var intersects = raycaster.intersectObjects(dialogBoxes);
            if(intersects.length > 0)
              alert(intersects[0].object.name);
          }
        }
        
      }
      
      function animate()
      {
        requestAnimationFrame(animate);
        if(mesh)
        {
          mesh.rotation.y += 0.02;
        }
        render();
      }
      
      function render()
      {
        camera.lookAt(scene.position);
        renderer.render(scene, camera);
      }
    </script>
  </body>
</html>
